<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="./style.css" />
<script src="./shaders.js"></script>
<script src="./lsystem.js"></script>
</head>
<body>

<div id="controls">
    <h2>L-System Controls</h2>
    <div>
        <label for="axiom">Axiom:</label>
        <input type="text" id="axiom" value="F">
    </div>
    <div style="margin-bottom: 20px;">
       <label for="rule">Rules (format: F=F+F--F+F):</label>
       <div id="ruleContainer" class="textarea-container">
          <div id="ruleMirror" class="mirror"></div>
          <textarea id="rule" rows="5">F=FF</textarea>
       </div>
       </textarea>
   </div>
    <div>
        <label for="depth">Recursion Depth:</label>
        <input type="number" id="depth" value="1" min="1" max="8">
    </div>
    <div id="centerControl">
      <label for="centerX">Center</label>
      <input type="number" id="centerX" value="0" step="any">
      <input type="number" id="centerY" value="0" step="any">
    </div>
    <div>
        <label for="length">Segment Length:</label>
        <input type="number" id="length" value="0.1">
    </div>
    <div>
        <label for="baseAngle">Base Angle:</label>
        <input type="number" id="baseAngle" value="60">
    </div>
    <div>
        <label for="wave">Animate Amount:</label>
        <input type="number" id="wave" value="0">
    </div>
    <div>
        <label for="currentAngle">Current Rendering Angle:</label>
        <input type="text" id="currentAngle" readonly>
    </div>

    <hr />
    <div id="shaderCodeContainer" style="margin-top: 20px;">
      <select id="shaderPresetSelector">
        <option value="Custom">Select a Shader Preset</option>
        <!-- Options will be dynamically populated -->
      </select>
    <button id="toggleShaderCode">Edit Shader Code</button>
    <div id="shaderCodeContent" style="display: none;">
      <button id="updateShader">Update Shaders</button>
        <textarea id="vShader" rows="10" style="width: 100%;">
          attribute vec4 aVertexPosition;
          attribute float aDepth;
          attribute float aAxiom; // New attribute for axiom

          varying float vDepth;
          varying float vAxiom; // Pass axiom to fragment shader

          void main(void) {
              gl_Position = aVertexPosition;
              vDepth = aDepth;
              vAxiom = aAxiom;
          }
        </textarea>
        <textarea id="fShader" rows="10" style="width: 100%;">
          precision mediump float;

          varying float vDepth;
          varying float vAxiom;

          void main(void) {
              // Enhanced base color variation affected by axiom
              // Cycle through colors more broadly
              vec3 baseColor = vec3(sin(vAxiom * 0.2 + 1.0) * 0.5 + 0.5,
                                    cos(vAxiom * 0.2 + 2.0) * 0.5 + 0.5,
                                    sin(vAxiom * 0.2 + 3.0) * 0.5 + 0.5);

              // Adjust color brightness based on depth to ensure visibility
              // Use a non-linear transformation to avoid colors becoming too bright or too dark
              float brightnessFactor = clamp((cos(vDepth / 100. - 1.0) + 1.0) * 0.5, 0.3, 0.9);

              vec3 color = baseColor * brightnessFactor;

              gl_FragColor = vec4(color, 1.0);
          }

        </textarea>
    </div>
</div>

    <button id="update">Create Link</button>
    <button id="tweet">Tweet</button>

</div>

<canvas id="glcanvas" width="1024" height="768"></canvas>
<div id="dragMessage" style="display: none;"><!--<h2>Click In This Area</h2>--></div>

</body>
</html>
